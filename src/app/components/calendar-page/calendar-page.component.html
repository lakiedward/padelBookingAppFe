<div class="page page-gradient-bg bg-admin-like">
  <!-- Header (reused style) -->
  <header class="header">
    <div class="container header__inner">
      <div class="brand">
        <div class="logo-mark">
          <svg class="logo-svg" fill="none" viewBox="0 0 32 32" aria-hidden="true">
            <g>
              <circle cx="16" cy="16" r="12" fill="#a7ee43"></circle>
              <path d="M10 18c3 3 9 3 12-3" stroke="black" stroke-width="2" fill="none" stroke-linecap="round"></path>
              <circle cx="20" cy="12" r="2" fill="black"></circle>
            </g>
          </svg>
        </div>
        <div class="brand__text">
          <div class="brand__title">PLAYORA</div>
          <div class="brand__subtitle">Sports Club Management Platform</div>
        </div>
      </div>

      <nav class="nav nav--desktop">
        <a class="nav__link" [routerLink]="['/user']" routerLinkActive="nav__link--active" [routerLinkActiveOptions]="{ exact: true }">Courts</a>
        <a class="nav__link nav__link--active" aria-current="page">Calendar</a>
        <a class="nav__link nav__link--muted" href="javascript:void(0)">About</a>
        <a class="nav__link nav__link--muted" href="javascript:void(0)">Contact</a>
      </nav>

      <div class="actions actions--desktop">
        <span class="user-mail">user@playora.com</span>
        <button class="btn" (click)="logout()">Logout</button>
      </div>

      <button class="btn-icon nav-toggle" aria-label="Toggle menu" (click)="toggleMobile()">
        <svg *ngIf="!mobileOpen" viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
          <path d="M4 6H20M4 12H20M4 18H20" />
        </svg>
        <svg *ngIf="mobileOpen" viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
          <path d="M6 6L18 18M6 18L18 6" />
        </svg>
      </button>
    </div>

    <div *ngIf="mobileOpen" class="drawer">
      <div class="drawer__inner">
        <a class="drawer__link" [routerLink]="['/user']">Courts</a>
        <a class="drawer__link drawer__link--active">Calendar</a>
        <a class="drawer__link drawer__link--muted">About</a>
        <a class="drawer__link drawer__link--muted">Contact</a>
        <div class="divider"></div>
        <div class="drawer__mail">user@playora.com</div>
        <button class="btn btn--block" (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container hero__inner">
      <div class="hero__head">
        <h1 class="hero__title">
          <span class="muted">Your Bookings, At A </span><span class="accent">Glance</span>
        </h1>
        <p class="hero__subtitle">Manage your reservations and stay on top of your sports schedule.</p>
      </div>
    </div>
  </section>

  <!-- Content -->
  <main class="container content">
    

    <section class="calendar-panel">
      <div class="toolbar">
        <div class="toolbar__left">
          <button class="btn" (click)="goPrev()">Prev</button>
          <button class="btn" (click)="goToday()">Today</button>
          <button class="btn" (click)="goNext()">Next</button>
        </div>
        <div class="toolbar__right">
          <span class="label">View:</span>
          <button class="pill" [class.pill--active]="viewMode() === 'month'" (click)="setView('month')">Month</button>
          <button class="pill" [class.pill--active]="viewMode() === 'week'" (click)="setView('week')">Week</button>
          <button class="pill" [class.pill--active]="viewMode() === 'day'" (click)="setView('day')">Day</button>
        </div>
      </div>

      <div class="headline">{{ headline() }}</div>

      <!-- Month view -->
      <ng-container *ngIf="viewMode() === 'month'; else nonMonth">
        <!-- Desktop: Classic calendar grid -->
        <div class="desktop-calendar">
          <div class="weekdays">
            <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
          </div>
          <div class="month-grid">
            <div class="cal-day cal--month" *ngFor="let c of monthMatrix(); let i = index"
                 [class.cal-day--faded]="!c.inCurrent" [class.cal-day--today]="isToday(c.date)" (click)="onDayClick(c.date)">
              <div class="cal-day__header">
                <div class="cal-day__title">{{ weekdayShort(c.date) }}</div>
                <ng-container [ngSwitch]="reservationsByDay(c.date).length">
                  <span *ngSwitchCase="0"></span>
                  <span *ngSwitchDefault class="cal-day__badge">{{ reservationsByDay(c.date).length }}</span>
                </ng-container>
              </div>
              <div class="cal-day__num">{{ c.date.getDate() }}</div>
              <div class="cal-day__body">
                <div class="cal-event" *ngFor="let r of (reservationsByDay(c.date) | slice:0:3)">
                  <span class="cal-event__icon">{{ r.sport }}</span>
                  <span class="cal-event__text" [title]="r.court">{{ r.court }}</span>
                </div>
              </div>
              <div class="cal-day__footer" *ngIf="reservationsByDay(c.date).length > 3">+{{ reservationsByDay(c.date).length - 3 }} more</div>
            </div>
          </div>
        </div>

        <!-- Mobile: Weeks layout -->
        <div class="mobile-calendar">
          <div class="weeks-container">
            <div class="week-section" *ngFor="let week of getWeeksInMonth(); let weekIndex = index">
              <div class="week-header">
                <h3 class="week-title">Week {{ weekIndex + 1 }}</h3>
                <span class="week-dates">{{ formatWeekRange(week) }}</span>
              </div>
              <div class="week-grid">
                <div class="cal-day cal--month" *ngFor="let day of week"
                     [class.cal-day--faded]="!day.inCurrent" [class.cal-day--today]="isToday(day.date)" (click)="onDayClick(day.date)">
                  <div class="cal-day__header">
                    <div class="cal-day__title">{{ weekdayShort(day.date) }}</div>
                    <ng-container [ngSwitch]="reservationsByDay(day.date).length">
                      <span *ngSwitchCase="0"></span>
                      <span *ngSwitchDefault class="cal-day__badge">{{ reservationsByDay(day.date).length }}</span>
                    </ng-container>
                  </div>
                  <div class="cal-day__num">{{ day.date.getDate() }}</div>
                  <div class="cal-day__body">
                    <div class="cal-event" *ngFor="let r of (reservationsByDay(day.date) | slice:0:1)">
                      <span class="cal-event__icon">{{ r.sport }}</span>
                      <span class="cal-event__text" [title]="r.court">{{ r.court }}</span>
                    </div>
                  </div>
                  <div class="cal-day__footer" *ngIf="reservationsByDay(day.date).length > 1">+{{ reservationsByDay(day.date).length - 1 }} more</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Week/Day views -->
      <ng-template #nonMonth>
        <div *ngIf="viewMode() === 'week'; else dayView">
          <div class="week-head">
            <div *ngFor="let d of weekDays()" class="week-head__cell" [class.week-head__cell--today]="isToday(d)">{{ weekdayShort(d) }} {{ d.getDate() }}</div>
          </div>
          <div class="week-cols">
            <div class="week-col" *ngFor="let d of weekDays()" [class.week-col--today]="isToday(d)">
              <div class="res-item" *ngFor="let r of reservationsByDay(d)">
                <div class="res-item__left">
                  <div class="emoji">{{ r.sport }}</div>
                  <div class="meta">
                    <div class="title">{{ r.court }}</div>
                    <div class="sub">{{ r.club }}<ng-container *ngIf="r.city"> • {{ r.city }}</ng-container></div>
                  </div>
                </div>
                <div class="time">{{ r.start }} – {{ r.end }}</div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #dayView>
          <div class="day-list">
            <div class="empty" *ngIf="reservationsByDay(anchor()).length === 0">No reservations</div>
            <div class="res-item" *ngFor="let r of reservationsByDay(anchor())">
              <div class="res-item__left">
                <div class="emoji">{{ r.sport }}</div>
                <div class="meta">
                  <div class="title">{{ r.court }}</div>
                  <div class="sub">{{ r.club }}<ng-container *ngIf="r.city"> • {{ r.city }}</ng-container></div>
                </div>
              </div>
              <div class="time">{{ r.start }} – {{ r.end }}</div>
            </div>
          </div>
        </ng-template>
      </ng-template>

      <!-- Courts section for Week and Day views -->
      <div *ngIf="viewMode() === 'week' || viewMode() === 'day'" class="courts-section">
        <h3 class="courts-section__title">Your Courts</h3>
        <div class="grid">
          <app-court-listing-card
            *ngFor="let court of getUniqueCourts()"
            [image]="getCourtImage(court.court)"
            [emoji]="court.sport"
            [title]="court.court"
            [club]="court.club"
            [location]="getCourtLocation(court.court)"
            [price]="getCourtPrice(court.court)"
            unit="per hour"
            [tags]="getCourtTags(court.court)"
            [availableDate]="getNextAvailableDate(court.court)"
            [slots]="getCourtSlots(court.court)"
          />
        </div>
      </div>

    </section>
  </main>
</div>
