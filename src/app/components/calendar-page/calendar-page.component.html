<div class="page page-gradient-bg bg-admin-like">
  <app-header></app-header>

  <div class="hero">
    <div class="glow glow--hero-a"></div>
    <div class="glow glow--hero-b"></div>
    <div class="glow glow--hero-c"></div>
    <div class="container hero__inner">
      <div class="hero__head">
        <h1 class="hero__title">
          <span class="muted">Your Bookings, At A </span><span class="accent">Glance</span>
        </h1>
        <p class="hero__subtitle">Manage your reservations and stay on top of your sports schedule.</p>
      </div>
    </div>
  </div>

  <!-- Content -->
  <main class="container content">
    

    <section class="calendar-panel">
      <div class="toolbar">
        <div class="toolbar__left">
          <button class="btn" (click)="goPrev()">Prev</button>
          <button class="btn" (click)="goToday()">Today</button>
          <button class="btn" (click)="goNext()">Next</button>
        </div>
        <div class="toolbar__right">
          <button class="pill" [class.pill--active]="viewMode() === 'month'" (click)="setView('month')">Month</button>
          <button class="pill" [class.pill--active]="viewMode() === 'week'" (click)="setView('week')">Week</button>
          <button class="pill" [class.pill--active]="viewMode() === 'day'" (click)="setView('day')">Day</button>
        </div>
      </div>

      <div class="headline">{{ headline() }}</div>

      <!-- Month view -->
      <ng-container *ngIf="viewMode() === 'month'; else nonMonth">
        <!-- Desktop: Classic calendar grid -->
        <div class="desktop-calendar">
          <div class="weekdays">
            <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
          </div>
          <div class="month-grid">
            <div class="cal-day cal--month" *ngFor="let c of monthMatrix(); let i = index"
                 [class.cal-day--faded]="!c.inCurrent" [class.cal-day--today]="isToday(c.date)" (click)="onDayClick(c.date)">
              <div class="cal-day__header">
                <div class="cal-day__title">{{ weekdayShort(c.date) }}</div>
                <ng-container [ngSwitch]="reservationsByDay(c.date).length">
                  <span *ngSwitchCase="0"></span>
                  <span *ngSwitchDefault class="cal-day__badge">{{ reservationsByDay(c.date).length }}</span>
                </ng-container>
              </div>
              <div class="cal-day__content">
                <div class="cal-day__num">{{ c.date.getDate() }}</div>
                <div class="cal-day__body">
                  <div class="cal-event" *ngFor="let r of (reservationsByDay(c.date) | slice:0:3)">
                    <span class="cal-event__icon">{{ r.sport }}</span>
                    <span class="cal-event__text" [title]="r.court">{{ r.court }}</span>
                  </div>
                </div>
              </div>
              <div class="cal-day__footer" *ngIf="reservationsByDay(c.date).length > 3">+{{ reservationsByDay(c.date).length - 3 }} more</div>
            </div>
          </div>
        </div>

        <!-- Mobile: Weeks layout -->
        <div class="mobile-calendar">
          <div class="weeks-container">
            <div class="week-section" *ngFor="let week of getWeeksInMonth(); let weekIndex = index">
              <div class="week-header">
                <h3 class="week-title">Week {{ weekIndex + 1 }}</h3>
                <span class="week-dates">{{ formatWeekRange(week) }}</span>
              </div>
              <div class="week-grid">
                <div class="cal-day cal--month" *ngFor="let day of week"
                     [class.cal-day--faded]="!day.inCurrent" [class.cal-day--today]="isToday(day.date)" (click)="onDayClick(day.date)">
                  <div class="cal-day__header">
                    <div class="cal-day__title">{{ weekdayShort(day.date) }}</div>
                    <ng-container [ngSwitch]="reservationsByDay(day.date).length">
                      <span *ngSwitchCase="0"></span>
                      <span *ngSwitchDefault class="cal-day__badge">{{ reservationsByDay(day.date).length }}</span>
                    </ng-container>
                  </div>
                  <div class="cal-day__content">
                    <div class="cal-day__num">{{ day.date.getDate() }}</div>
                    <div class="cal-day__body">
                      <div class="cal-event" *ngFor="let r of (reservationsByDay(day.date) | slice:0:1)">
                        <span class="cal-event__icon">{{ r.sport }}</span>
                        <span class="cal-event__text" [title]="r.court">{{ r.court }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="cal-day__footer" *ngIf="reservationsByDay(day.date).length > 1">+{{ reservationsByDay(day.date).length - 1 }} more</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Week/Day views -->
      <ng-template #nonMonth>
        <div *ngIf="viewMode() === 'week'; else dayView">
          <div class="week-head">
            <div *ngFor="let d of weekDays()" class="week-head__cell" [class.week-head__cell--today]="isToday(d)">{{ weekdayShort(d) }} {{ d.getDate() }}</div>
          </div>
          <div class="week-cols">
            <div class="week-col" *ngFor="let d of weekDays()" [class.week-col--today]="isToday(d)">
              <div class="week-col__label">{{ weekdayShort(d) }} {{ d.getDate() }}</div>
              <!-- Desktop: month-like day box inside week view -->
              <div class="cal-day cal--week" [class.cal-day--today]="isToday(d)">
                <div class="cal-day__header">
                  <div class="cal-day__title">{{ weekdayShort(d) }}</div>
                  <ng-container [ngSwitch]="reservationsByDay(d).length">
                    <span *ngSwitchCase="0"></span>
                    <span *ngSwitchDefault class="cal-day__badge">{{ reservationsByDay(d).length }}</span>
                  </ng-container>
                </div>
                <div class="cal-day__content">
                  <div class="cal-day__num">{{ d.getDate() }}</div>
                  <div class="cal-day__body">
                    <div class="cal-event" *ngFor="let r of reservationsByDay(d)">
                      <span class="cal-event__icon">{{ r.sport }}</span>
                      <span class="cal-event__text" [title]="r.court">{{ r.court }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="res-item res-item--interactive"
                *ngFor="let r of reservationsByDay(d)"
                (click)="onReservationClick(r)"
                (keydown)="onReservationKeyDown($event, r)"
                role="button"
                tabindex="0"
              >
                <div class="res-item__left">
                  <div class="emoji">{{ r.sport }}</div>
                  <div class="meta">
                    <div class="title">{{ r.court }}</div>
                    <div class="sub">{{ r.club }}<ng-container *ngIf="r.city"> • {{ r.city }}</ng-container></div>
                  </div>
                </div>
                <div class="time">{{ r.start | time24 }} – {{ r.end | time24 }}</div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #dayView>
          <div class="day-list">
            <div class="empty" *ngIf="reservationsByDay(anchor()).length === 0">No reservations</div>
            <div
              class="res-item res-item--interactive"
              *ngFor="let r of reservationsByDay(anchor())"
              (click)="onReservationClick(r)"
              (keydown)="onReservationKeyDown($event, r)"
              role="button"
              tabindex="0"
            >
              <div class="res-item__left">
                <div class="emoji">{{ r.sport }}</div>
                <div class="meta">
                  <div class="title">{{ r.court }}</div>
                  <div class="sub">{{ r.club }}<ng-container *ngIf="r.city"> • {{ r.city }}</ng-container></div>
                </div>
              </div>
              <div class="time">{{ r.start | time24 }} – {{ r.end | time24 }}</div>
            </div>
          </div>
        </ng-template>
      </ng-template>

      <!-- Courts section for Week and Day views -->
      <div *ngIf="viewMode() === 'week' || viewMode() === 'day'" class="courts-section">
        <h3 class="courts-section__title">Your Courts</h3>
        
        <!-- Loading state -->
        <div *ngIf="isLoading" style="text-align: center; padding: 40px; color: #8aa0b5;">
          Loading your bookings...
        </div>
        
        <!-- Empty state -->
        <div *ngIf="!isLoading && getUniqueCourts().length === 0" style="text-align: center; padding: 40px; color: #8aa0b5;">
          <p>No bookings found for this period.</p>
          <p style="font-size: 14px; margin-top: 8px;">Book a court to see it here!</p>
        </div>
        
        <!-- Courts grid -->
        <div *ngIf="!isLoading && getUniqueCourts().length > 0" class="grid">
          <app-court-listing-card
            *ngFor="let court of getUniqueCourts()"
            [image]="getCourtImage(court.courtId)"
            [emoji]="court.sport"
            [title]="court.court"
            [club]="court.club"
            [location]="getCourtLocation(court.court)"
            [price]="getCourtPrice(court.court)"
            unit="per hour"
            [tags]="getCourtTags(court.court)"
            [availableDate]="getNextAvailableDate(court.court)"
            [slots]="getCourtSlots(court.court)"
            mode="reservation"
            (cardClick)="onCourtCardClick(court)"
          />
        </div>
      </div>

    </section>
  </main>
</div>
