<div class="login-container">
  <p-toast key="auth" position="top-right" appendTo="body" [baseZIndex]="10000"></p-toast>
  <ng-container *ngIf="!success; else successTpl">
  <h2 class="login-title">Playora</h2>
  <p class="login-subtitle">Sign up to book your favorite courts</p>

  <div class="form-field" style="margin-bottom: 8px;">
    <div class="btn-group" style="display:flex; gap:8px;">
      <button type="button" class="btn" [class.btn--primary]="accountType === 'player'" (click)="accountType='player'">Player</button>
      <button type="button" class="btn" [class.btn--primary]="accountType === 'owner'" (click)="accountType='owner'">Club Owner</button>
    </div>
  </div>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="login-form">
    <div class="form-field">
      <label for="username">Username</label>
      <input pInputText id="username" formControlName="username" placeholder="Enter your username" class="w-full" autocomplete="username" />
      <small class="error-message" *ngIf="registerForm.get('username')?.invalid && (registerForm.get('username')?.touched || registerForm.get('username')?.dirty || submitted)">
        <span *ngIf="registerForm.get('username')?.errors?.['required']">Username is required</span>
        <span *ngIf="registerForm.get('username')?.errors?.['minlength']">At least 3 characters</span>
      </small>
      <small class="error-message" *ngIf="registerForm.get('username')?.errors?.['serverExists'] as serverError">
        {{ serverError }}
      </small>
    </div>

    <div class="form-field">
      <label for="email">Email Address</label>
      <input pInputText id="email" formControlName="email" placeholder="Enter your email" class="w-full" autocomplete="email" />
      <small class="error-message" *ngIf="registerForm.get('email')?.invalid && (registerForm.get('email')?.touched || registerForm.get('email')?.dirty || submitted)">
        <span *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
        <span *ngIf="registerForm.get('email')?.errors?.['email']">Enter a valid email</span>
      </small>
      <small class="error-message" *ngIf="registerForm.get('email')?.errors?.['serverExists'] as serverError">
        {{ serverError }}
      </small>
    </div>

    <div class="form-field">
      <label for="phoneNumber">Phone Number</label>
      <input pInputText id="phoneNumber" formControlName="phoneNumber" placeholder="Enter your phone" class="w-full" autocomplete="tel" />
      <small class="error-message" *ngIf="registerForm.get('phoneNumber')?.invalid && (registerForm.get('phoneNumber')?.touched || registerForm.get('phoneNumber')?.dirty || submitted)">
        <span *ngIf="registerForm.get('phoneNumber')?.errors?.['required']">Phone is required</span>
        <span *ngIf="registerForm.get('phoneNumber')?.errors?.['pattern']">Enter a valid phone number</span>
      </small>
    </div>

    <div class="form-field">
      <label for="password">Password</label>
      <p-password formControlName="password" placeholder="Enter your password" [toggleMask]="false" [feedback]="false" styleClass="w-full" inputStyleClass="w-full"></p-password>
      <small class="error-message" *ngIf="registerForm.get('password')?.invalid && (registerForm.get('password')?.touched || registerForm.get('password')?.dirty || submitted)">
        <span *ngIf="registerForm.get('password')?.errors?.['required']">Password is required</span>
        <span *ngIf="registerForm.get('password')?.errors?.['minlength']">At least 6 characters</span>
      </small>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn--primary btn--full" [disabled]="
        loading ||
        (accountType==='player' && registerForm.invalid) ||
        (accountType==='owner' && (registerForm.get('email')?.invalid || registerForm.get('password')?.invalid))
      ">
        <span class="u-spinner u-spinner--sm" *ngIf="loading" aria-hidden="true"></span>
        <span *ngIf="!loading">{{ accountType === 'owner' ? 'Continue with Stripe Setup' : 'Sign Up' }}</span>
      </button>
    </div>

    <div class="divider"><span>Or continue with</span></div>

    <div id="googleButtonContainerRegister" class="btn btn--full google-btn-slot" *ngIf="useGoogleButton"></div>

    <button type="button" class="google-btn" (click)="onGoogleSignUp()" [disabled]="loading" *ngIf="!useGoogleButton">
      <img src="assets/icons/google.png" alt="Google" width="20" height="20" />
      Google
    </button>

    <div class="signup-link">
      <p>Already have an account? <button type="button" class="link" (click)="onSwitchToLogin()">Sign in</button></p>
    </div>
  </form>
  </ng-container>
  <ng-template #successTpl>
    <div class="success-box">
      <h2 class="login-title">You're all set!</h2>
      <p class="login-subtitle">You've successfully registered. Ready to start booking courts?</p>
      <div class="form-actions">
        <button type="button" class="btn btn--primary" (click)="onSwitchToLogin()">Sign in</button>
      </div>
    </div>
  </ng-template>
</div>

